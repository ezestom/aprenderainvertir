---
import sun from "../icons/sun.svg";
import moon from "../icons/moon.svg";
---

<button
	id="themeToggle"
	class="transition-colors group w-full flex items-center justify-start gap-2 hover:bg-[--darkblue] py-2 px-3 rounded-md">
	<span
		class="relative group-hover:rotate-45 group-hover:scale-110 transition duration-300 drop-shadow-md flex">
		<img
			id="sunIcon"
			src={sun.src}
			class="sun w-5 transition-all"
			alt="Sol"
		/>
		<img
			id="moonIcon"
			src={moon.src}
			class="moon w-5 transition-all"
			alt="Luna"
		/>
	</span>
	<span
		id="themeText"
		class="whitespace-nowrap font-semibold transition-colors text-sm group-hover:text-[--lightblue]">
		Ir a Modo Oscuro
	</span>
</button>

<style>
	.moon {
		display: none;
	}
	:global(.dark) .sun {
		display: none;
	}
	:global(.dark) .moon {
		display: inline-block;
	}
</style>

<script is:inline>
	// Declarar la variable `theme` globalmente si no existe
	if (typeof window.theme === "undefined") {
		window.theme = (() => {
			if (
				typeof localStorage !== "undefined" &&
				localStorage.getItem("theme")
			) {
				return localStorage.getItem("theme");
			}
			if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
				return "dark";
			}
			return "light";
		})();
	}

	// Aplicar el tema según la variable `theme`
	if (window.theme === "light") {
		document.documentElement.classList.remove("dark");
	} else {
		document.documentElement.classList.add("dark");
	}

	// Guardar el tema en `localStorage`
	window.localStorage.setItem("theme", window.theme);

	// Función para cambiar el tema cuando se hace clic en el botón
	const handleToggleClick = () => {
		const element = document.documentElement;
		element.classList.toggle("dark");

		const isDark = element.classList.contains("dark");
		window.localStorage.setItem("theme", isDark ? "dark" : "light");
	};

	// Agregar el evento de clic al botón con id `themeToggle`
	document
		.getElementById("themeToggle")
		.addEventListener("click", handleToggleClick);
</script>
