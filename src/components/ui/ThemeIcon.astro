---
import sun from "../../icons/sun.svg";
import moon from "../../icons/moon.svg";
---

<button
	id="themeToggle"
	class="transition-colors group w-full flex items-center justify-start gap-2 hover:bg-[--darkblue] py-2 px-3 rounded-md">
	<span
		class="relative group-hover:rotate-45 group-hover:scale-110 transition duration-300 drop-shadow-md">
		<img
			id="sunIcon"
			src={sun.src}
			class="sun w-5 transition-all"
			alt="Sol"
		/>
		<img
			id="moonIcon"
			src={moon.src}
			class="moon w-5 transition-all"
			alt="Luna"
		/>
	</span>
	<span
		id="themeText"
		class="whitespace-nowrap font-semibold transition-colors text-sm group-hover:text-[--lightblue]">
		Ir a Modo Oscuro
	</span>
</button>

<style>
	.moon {
		display: none;
	}
	:global(.dark) .sun {
		display: none;
	}
	:global(.dark) .moon {
		display: inline-block;
	}
</style>

<script is:inline>
	const theme = (() => {
		if (
			typeof localStorage !== "undefined" &&
			localStorage.getItem("theme")
		) {
			return localStorage.getItem("theme");
		}
		if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
			return "dark";
		}
		return "light";
	})();

	const updateThemeDisplay = (isDark) => {
		const sunIcon = document.getElementById("sunIcon");
		const moonIcon = document.getElementById("moonIcon");
		const themeText = document.getElementById("themeText");

		if (isDark) {
			sunIcon.style.display = "inline-block";
			moonIcon.style.display = "none";
			themeText.textContent = "Ir a Modo Claro";
		} else {
			sunIcon.style.display = "none";
			moonIcon.style.display = "inline-block";
			themeText.textContent = "Ir a Modo Oscuro";
		}
	};

	if (theme === "light") {
		document.documentElement.classList.remove("dark");
		updateThemeDisplay(false);
	} else {
		document.documentElement.classList.add("dark");
		updateThemeDisplay(true);
	}

	window.localStorage.setItem("theme", theme);

	const handleToggleClick = () => {
		const element = document.documentElement;
		element.classList.toggle("dark");

		const isDark = element.classList.contains("dark");
		localStorage.setItem("theme", isDark ? "dark" : "light");

		updateThemeDisplay(isDark);
	};

	document
		.getElementById("themeToggle")
		.addEventListener("click", handleToggleClick);
</script>
